<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>ğŸ€ Sniper J GM æ¨¡æ“¬å™¨ v0.9.0 Ultimate+</title>
  <style>
    body { font-family: sans-serif; padding: 20px; background: #f2f2f2; }
    h1 { color: #2c3e50; }
    button {
      margin: 5px; padding: 10px; font-size: 16px;
      border-radius: 5px; cursor: pointer;
      background-color: #3498db; color: white; border: none;
    }
    button:disabled { background-color: #aaa; cursor: not-allowed; }
    .player {
      background: white; margin: 10px 0; padding: 10px;
      border-radius: 6px; display: flex; align-items: center; justify-content: space-between;
    }
    .player-info { flex-grow: 1; }
    .progress-bar {
      width: 100%; background: #ddd; border-radius: 4px;
      overflow: hidden; margin-top: 4px; height: 8px;
    }
    .progress-bar-inner {
      height: 100%; background: #4caf50; width: 0%;
    }
    .section { margin-top: 30px; }
    .container { max-width: 900px; margin: auto; }
    select, input[type="text"] {
      padding: 5px 8px; font-size: 14px; margin: 5px 0;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ€ Sniper J GM æ¨¡æ“¬å™¨ v0.9.0 Ultimate+</h1>
    <div>
      <button id="clearBtn">æ¸…ç©ºå­˜æª”</button>
      <span id="dateDisplay"></span>
      <div id="moneyDisplay"></div>
    </div>
    <div class="section">
      <button id="showWarriorsBtn">å‹‡å£«é™£å®¹</button>
      <button id="showFreeAgentsBtn">è‡ªç”±å¸‚å ´</button>
      <button id="showTradeBtn">ç™¼èµ·äº¤æ˜“ (3æ›3)</button>
      <button id="simulateGameBtn">æ¨¡æ“¬æ¯”è³½</button>
      <button id="resetTrainingBtn">é‡ç½®è¨“ç·´</button>
    </div>
    <div id="team"></div>
    <div id="freeAgents"></div>
    <div id="otherTeam"></div>
    <div id="gameResult"></div>
  </div>
  <script>
(() => {
  const ratingMap = { "C":1,"C+":2,"B-":3,"B":4,"B+":5,"A-":6,"A":7,"A+":8,"S":9,"S+":10 };
  const ratingStars = r => "â˜…".repeat(Math.min(5, Math.round((ratingMap[r]||1)/2)));
  let warriors, freeAgents, otherTeams, money, salaryCap, lastSimDate, firstRoundPicks, trainLimit, todayTrained;
  let currentTradeTarget = null;

  function defaultData() {
    return {
      warriors: [
        { name:"Stephen Curry", rating:"S", salary:35, trainedToday:false, trainProgress:0 },
        { name:"Klay Thompson", rating:"B+", salary:20, trainedToday:false, trainProgress:0 },
        { name:"Draymond Green", rating:"B", salary:18, trainedToday:false, trainProgress:0 },
        { name:"Jonathan Kuminga", rating:"B", salary:15, trainedToday:false, trainProgress:0 },
        { name:"Andrew Wiggins", rating:"B+", salary:22, trainedToday:false, trainProgress:0 },
        { name:"Moses Moody", rating:"C+", salary:10, trainedToday:false, trainProgress:0 },
        { name:"Gary Payton II", rating:"C+", salary:9, trainedToday:false, trainProgress:0 },
        { name:"Brandin Podziemski", rating:"B-", salary:11, trainedToday:false, trainProgress:0 },
        { name:"Kevon Looney", rating:"C", salary:8, trainedToday:false, trainProgress:0 }
      ],
      freeAgents: [
        { name:"Malik Beasley", rating:"B", salary:15, signChance:60 },
        { name:"Robert Covington", rating:"B-", salary:12, signChance:50 },
        { name:"Dennis Smith Jr.", rating:"B-", salary:9, signChance:55 },
        { name:"Justise Winslow", rating:"C+", salary:7, signChance:45 },
        { name:"Tristan Thompson", rating:"C", salary:6, signChance:50 }
      ],
      otherTeams: {
        "é›·éœ†":[
          { name:"Shai Gilgeous-Alexander", rating:"S", salary:34 },
          { name:"Jalen Williams", rating:"A", salary:20 },
          { name:"Chet Holmgren", rating:"A-", salary:18 },
          { name:"Josh Giddey", rating:"B+", salary:16 },
          { name:"Lu Dort", rating:"B", salary:14 },
          { name:"Isaiah Joe", rating:"B-", salary:10 }
        ],
        "é‡‘å¡Š":[
          { name:"Nikola Jokic", rating:"S+", salary:38 },
          { name:"Jamal Murray", rating:"A", salary:27 },
          { name:"Aaron Gordon", rating:"B+", salary:24 },
          { name:"Michael Porter Jr.", rating:"B+", salary:22 },
          { name:"Kentavious Caldwell-Pope", rating:"B", salary:15 },
          { name:"Reggie Jackson", rating:"B-", salary:10 }
        ]
      },
      money:100, salaryCap:120, lastSimDate:null,
      firstRoundPicks:{"å‹‡å£«":2,"é›·éœ†":2,"é‡‘å¡Š":2}, trainLimit:5
    };
  }

  function loadData(){
    try {
      const s = JSON.parse(localStorage.getItem("sj_gm_data_v090")||"null");
      if(s && s.warriors) Object.assign(window, s);
      else throw "";
    } catch {
      Object.assign(window, defaultData());
    }
    todayTrained = [];
  }

  function saveData(){
    localStorage.setItem("sj_gm_data_v090", JSON.stringify({
      warriors, freeAgents, otherTeams, money, salaryCap, lastSimDate, firstRoundPicks, trainLimit
    }));
  }

  function renderDate(){
    const now=new Date().toLocaleDateString();
    const sal=warriors.reduce((a,p)=>a+p.salary,0);
    document.getElementById("dateDisplay").textContent = "ï½œä»Šå¤©ï¼š"+now;
    document.getElementById("moneyDisplay").textContent =
      `ï½œè³‡é‡‘ï¼š$${money}Mï½œå·¥è³‡ï¼š${sal}M/${salaryCap}M${sal>salaryCap?" âš ï¸":""}ï½œé¦–è¼ªç±¤ï¼š${firstRoundPicks["å‹‡å£«"]}`;
  }

  function showWarriors(){
    const container=document.getElementById("team");
    let trainedCount = warriors.filter(p=>p.trainedToday).length;
    container.innerHTML = "<h2>ğŸ€ å‹‡å£«é™£å®¹</h2>";
    warriors.forEach((p,i)=>{
      container.innerHTML += `
        <div class="player">
          <div class="player-info">
            <strong>${p.name}</strong>ï½œ${p.rating}ï½œ${ratingStars(p.rating)}ï½œ$${p.salary}M<br/>
            ğŸ“ˆ é€²åº¦ï¼š${p.trainProgress}% ${getNextRating(p.rating)?`(å‡ç´šç›®æ¨™ï¼š${getNextRating(p.rating)})`:''}
          </div>
          <button ${p.trainedToday||trainedCount>=trainLimit?"disabled":''}>è¨“ç·´</button>
        </div>`;
    });
    container.querySelectorAll("button").forEach((btn,i)=>{
      btn.addEventListener("click",()=>{
        let p=warriors[i];
        if(p.trainedToday || trainedCount>=trainLimit) return;
        p.trainedToday=true;
        p.trainProgress = Math.min(100, p.trainProgress + Math.floor(Math.random()*20+10));
        let msg=`${p.name} å®Œæˆè¨“ç·´ï¼Œç›®å‰ ${p.trainProgress}%`;
        if(p.trainProgress>=100){
          if(tryUpgrade(p)) msg+=` ğŸ‰ æˆåŠŸå‡ç´šç‚º ${p.rating}!`;
          else msg+=` å¯æƒœæ²’å‡ç´šï¼Œç¹¼çºŒåŠªåŠ›!`;
          p.trainProgress=0;
        }
        alert(msg);
        saveData(); showWarriors(); renderDate();
      });
    });
  }

  function showFreeAgents(){
    const c=document.getElementById("freeAgents");
    c.innerHTML="<h2>ğŸ“ è‡ªç”±å¸‚å ´</h2>";
    freeAgents.forEach((p,i)=>{
      c.innerHTML+=`
        <div class="player">
          <div class="player-info"><strong>${p.name}</strong>ï½œ${p.rating}ï½œ${ratingStars(p.rating)}ï½œ$${p.salary}M</div>
          <button>ç°½ç´„</button>
        </div>`;
    });
    c.querySelectorAll("button").forEach((btn,i)=>{
      btn.addEventListener("click",()=>{
        const p=freeAgents[i];
        if(money<p.salary) return alert("è³‡é‡‘ä¸è¶³ï¼");
        if(Math.random()*100 < p.signChance){
          warriors.push({ ...p, trainedToday:false, trainProgress:0 });
          money -= p.salary; freeAgents.splice(i,1);
          alert(`${p.name} åŠ å…¥çƒéšŠï¼`);
        } else alert(`${p.name} æ‹’çµ•åŠ å…¥ã€‚`);
        saveData(); showFreeAgents(); showWarriors(); renderDate();
      });
    });
  }

  function showTradeUI(){
    const area=document.getElementById("otherTeam");
    area.innerHTML="<h2>ğŸ” äº¤æ˜“ä¸­å¿ƒ</h2>";
    Object.keys(otherTeams).forEach(tm=>{
      area.innerHTML+=`<button data-team="${tm}">${tm}</button>`;
    });
    area.querySelectorAll("button[data-team]").forEach(btn=>{
      btn.addEventListener("click",()=>prepareTradeUI(btn.dataset.team));
    });
  }

  function prepareTradeUI(team){
    currentTradeTarget=team;
    const opp=otherTeams[team];
    const area=document.getElementById("otherTeam");
    area.innerHTML=`
      <h2>ğŸ’¼ èˆ‡ ${team} äº¤æ˜“</h2>
      <p>æœ€å¤š 3 æ› 3ï¼Œå¯åŠ /å–é¦–è¼ªç±¤</p>
      <div id="tradeArea"></div><div id="tradeResult"></div>`;
    const ta=document.getElementById("tradeArea");
    ta.innerHTML = `<h3>æˆ‘æ–¹çƒå“¡</h3>` + warriors.map((p,i)=>`
      <label><input type="checkbox" class="w-trade" value="${i}"> ${p.name}ï½œ${p.rating}</label><br/>`
    ).join("") + `<label><input type="checkbox" id="myPick"> åŠ å…¥æˆ‘æ–¹é¦–è¼ªç±¤</label><hr/>` +
    `<h3>${team}çƒå“¡</h3>` + opp.map((p,i)=>`
      <label><input type="checkbox" class="o-trade" value="${i}"> ${p.name}ï½œ${p.rating}</label><br/>`
    ).join("") + `<label><input type="checkbox" id="theirPick"> è¦æ±‚å°æ–¹é¦–è¼ªç±¤</label><br/><button id="submitTrade">æå‡ºäº¤æ˜“</button>`;
    document.getElementById("submitTrade").addEventListener("click",()=>{
      const mySel=[...ta.querySelectorAll(".w-trade:checked")].map(cb=>warriors[cb.value]);
      const theirSel=[...ta.querySelectorAll(".o-trade:checked")].map(cb=>opp[cb.value]);
      if(mySel.length>3||theirSel.length>3) return alert("æœ€å¤š 3 æ› 3ï¼");
      let myVal=mySel.reduce((s,p)=>s+ratingMap[p.rating],0);
      let theirVal=theirSel.reduce((s,p)=>s+ratingMap[p.rating],0);
      if(document.getElementById("myPick").checked){
        if(firstRoundPicks["å‹‡å£«"]<=0) return alert("æ²’ç±¤äº†");
        myVal+=4;
      }
      if(document.getElementById("theirPick").checked) theirVal+=4;
      let diff=myVal-theirVal, msg="";
      if(diff>2) msg="âŒ ä½ çµ¦å¤ªå¤š";
      else if(diff<-4) msg="âŒ å°æ–¹è¦ºå¾—åƒè™§å¤ªå¤š";
      else {
        msg="âœ… äº¤æ˜“æˆåŠŸï¼";
        if(document.getElementById("myPick").checked) firstRoundPicks["å‹‡å£«"]--;
        if(document.getElementById("theirPick").checked) firstRoundPicks["å‹‡å£«"]++;
        warriors = warriors.filter(p=>!mySel.includes(p)).concat(theirSel.map(p=>({...p,trainProgress:0, trainedToday:false})));
        otherTeams[team] = opp.filter(p=>!theirSel.includes(p)).concat(mySel);
        saveData(); showWarriors(); renderDate();
      }
      document.getElementById("tradeResult").textContent = msg;
    });
  }

  function simulateGame(){
    const today=new Date().toDateString();
    if(lastSimDate===today) return alert("ä»Šå¤©å·²æ¯”è³½ï¼");
    const teams=Object.keys(otherTeams);
    const rt=teams[Math.floor(Math.random()*teams.length)], opp=otherTeams[rt];
    const teamScore=warriors.reduce((s,p)=>s+ratingMap[p.rating]*(Math.random()+0.5),0);
    const oppScore=opp.reduce((s,p)=>s+ratingMap[p.rating]*(Math.random()+0.5),0);
    const mvp=warriors.reduce((top,p)=>{
      const sc=ratingMap[p.rating]*(Math.random()+0.5);
      return sc>top.score?{name:p.name,score:sc}:top;
    },{name:"",score:0});
    document.getElementById("gameResult").innerHTML=`
      <h2>ğŸ“Š æ¨¡æ“¬æ¯”è³½çµæœ</h2>
      <p>ğŸ€ å‹‡å£« ${Math.round(teamScore)} : ${Math.round(oppScore)} ${rt}</p>
      <p>ğŸ– MVPï¼š${mvp.name}</p>`;
    lastSimDate=today; saveData(); renderDate();
  }

  function getNextRating(r){
    const ord=["C","C+","B-","B","B+","A-","A","A+","S","S+"];
    const idx=ord.indexOf(r);
    return idx>=0&&idx<ord.length-1?ord[idx+1]:null;
  }
  function tryUpgrade(p){
    const nr=getNextRating(p.rating);
    if(!nr) return false;
    if(Math.random()<0.3){p.rating=nr; return true;}
    return false;
  }

  function resetTraining(){ warriors.forEach(p=>p.trainedToday=false); alert("å·²é‡ç½®è¨“ç·´ï¼"); saveData(); showWarriors(); }

  function dailyAutoUpdate(){
    const t=new Date().toDateString(), sd=localStorage.getItem("sj_last_date");
    if(sd!==t){
      warriors.forEach(p=>p.trainedToday=false);
      localStorage.setItem("sj_last_date",t);
      saveData(); renderDate(); showWarriors();
    }
  }

  document.addEventListener("DOMContentLoaded",()=>{
    loadData(); dailyAutoUpdate(); renderDate(); showWarriors();
    document.getElementById("showWarriorsBtn").onclick=showWarriors;
    document.getElementById("showFreeAgentsBtn").onclick=showFreeAgents;
    document.getElementById("showTradeBtn").onclick=showTradeUI;
    document.getElementById("simulateGameBtn").onclick=simulateGame;
    document.getElementById("resetTrainingBtn").onclick=resetTraining;
    document.getElementById("clearBtn").onclick=()=>{
      if(confirm("ç¢ºèªæ¸…é™¤è³‡æ–™ï¼Ÿ")){ localStorage.clear(); location.reload();}
    };
    setInterval(dailyAutoUpdate,60000);
  });
})();
  </script>
</body>
</html>