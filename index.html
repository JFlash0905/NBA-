<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>Sniper J GM æ¨¡æ“¬å™¨ v0.9.0 Ultimate+</title>
  <style>
    body{font-family:sans-serif;padding:20px;background:#f2f2f2;}
    h1{color:#2c3e50;}
    button{margin:5px;padding:10px;font-size:16px;border:none;border-radius:5px;background:#3498db;color:#fff;cursor:pointer;}
    button:disabled{background:#aaa;cursor:not-allowed;}
    .section{margin-top:20px;}
    .player{background:#fff;margin:10px 0;padding:10px;border-radius:6px;display:flex;justify-content:space-between;align-items:center;}
    .player-info{flex-grow:1;}
    .progress-bar{width:100%;background:#ddd;border-radius:4px;overflow:hidden;height:8px;margin-top:4px;}
    .container{max-width:900px;margin:auto;}
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ€ Sniper J GM æ¨¡æ“¬å™¨ v0.9.0</h1>
    <div>
      <button id="clearBtn">æ¸…ç©ºå­˜æª”</button>
      <span id="dateDisplay"></span>
      <div id="moneyDisplay"></div>
    </div>
    <div class="section">
      <button id="showWarriorsBtn">å‹‡å£«é™£å®¹</button>
      <button id="showFreeAgentsBtn">è‡ªç”±å¸‚å ´</button>
      <button id="showTradeBtn">ç™¼èµ·äº¤æ˜“ (3æ›3)</button>
      <button id="simulateGameBtn">æ¨¡æ“¬æ¯”è³½</button>
      <button id="resetTrainingBtn">é‡ç½®è¨“ç·´</button>
    </div>
    <div id="teamContainer"></div>
    <div id="freeAgentContainer"></div>
    <div id="tradeContainer"></div>
    <div id="gameResult"></div>
  </div>

  <script>
  (() => {
    const ratingMap={"C":1,"C+":2,"B-":3,"B":4,"B+":5,"A-":6,"A":7,"A+":8,"S":9,"S+":10};
    const ratingStars=r=>"â˜…".repeat(Math.min(5,Math.round((ratingMap[r]||1)/2)));
    let warriors,freeAgents,otherTeams,money,salaryCap,lastSimDate,firstRoundPicks,trainLimit,todayTrained, currentTradeTarget;

    function defaultData(){
      return {
        warriors:[
          {name:"Stephen Curry",rating:"S",salary:35,trainProgress:0,trainedToday:false},
          {name:"Klay Thompson",rating:"B+",salary:20,trainProgress:0,trainedToday:false},
          {name:"Draymond Green",rating:"B",salary:18,trainProgress:0,trainedToday:false},
          {name:"Jonathan Kuminga",rating:"B",salary:15,trainProgress:0,trainedToday:false},
          {name:"Andrew Wiggins",rating:"B+",salary:22,trainProgress:0,trainedToday:false},
          {name:"Moses Moody",rating:"C+",salary:10,trainProgress:0,trainedToday:false},
          {name:"Gary Payton II",rating:"C+",salary:9,trainProgress:0,trainedToday:false},
          {name:"Brandin Podziemski",rating:"B-",salary:11,trainProgress:0,trainedToday:false},
          {name:"Kevon Looney",rating:"C",salary:8,trainProgress:0,trainedToday:false}
        ],
        freeAgents:[
          {name:"Malik Beasley",rating:"B",salary:15,signChance:60},
          {name:"Robert Covington",rating:"B-",salary:12,signChance:50},
          {name:"Dennis Smith Jr.",rating:"B-",salary:9,signChance:55},
          {name:"Justise Winslow",rating:"C+",salary:7,signChance:45},
          {name:"Tristan Thompson",rating:"C",salary:6,signChance:50}
        ],
        otherTeams:{
          "é›·éœ†":[
            {name:"Shai Gilgeousâ€‘Alexander",rating:"S",salary:34},
            {name:"Jalen Williams",rating:"A",salary:20},
            {name:"Chet Holmgren",rating:"A-",salary:18},
            {name:"Josh Giddey",rating:"B+",salary:16},
            {name:"Lu Dort",rating:"B",salary:14},
            {name:"Isaiah Joe",rating:"B-",salary:10}
          ],
          "é‡‘å¡Š":[
            {name:"Nikola Jokic",rating:"S+",salary:38},
            {name:"Jamal Murray",rating:"A",salary:27},
            {name:"Aaron Gordon",rating:"B+",salary:24},
            {name:"Michael Porter Jr.",rating:"B+",salary:22},
            {name:"Kentavious Caldwellâ€‘Pope",rating:"B",salary:15},
            {name:"Reggie Jackson",rating:"B-",salary:10}
          ]
        },
        money:100,
        salaryCap:120,
        lastSimDate:null,
        firstRoundPicks:{"å‹‡å£«":2,"é›·éœ†":2,"é‡‘å¡Š":2},
        trainLimit:5
      };
    }

    function loadData(){
      const obj=JSON.parse(localStorage.getItem("sj_gm_v090")||"null");
      if(obj) Object.assign(window,obj);
      else Object.assign(window,defaultData());
      todayTrained=[];
    }

    function saveData(){
      localStorage.setItem("sj_gm_v090",JSON.stringify({
        warriors,freeAgents,otherTeams,money,salaryCap,lastSimDate,firstRoundPicks,trainLimit
      }));
    }

    function renderDate(){
      const today=new Date().toLocaleDateString();
      const totalSal=warriors.reduce((a,p)=>a+p.salary,0);
      document.getElementById("dateDisplay").textContent="ï½œä»Šå¤©ï¼š"+today;
      document.getElementById("moneyDisplay").textContent=
        `ï½œè³‡é‡‘ï¼š$${money}Mï½œå·¥è³‡ï¼š${totalSal}M/${salaryCap}M${totalSal>salaryCap?" âš ï¸":""}ï½œé¦–è¼ªç±¤ï¼š${firstRoundPicks["å‹‡å£«"]}å¼µ`;
    }

    function getNextRating(r){
      const order=["C","C+","B-","B","B+","A-","A","A+","S","S+"];
      const idx=order.indexOf(r);return idx<order.length-1?order[idx+1]:null;
    }

    function showWarriors(){
      const cont=document.getElementById("teamContainer");
      cont.innerHTML="<h2>ğŸ€ å‹‡å£«é™£å®¹</h2>";
      let used=0;
      warriors.forEach((p,i)=>{
        const btnDisabled=p.trainedToday||used>=trainLimit;
        if(!p.trainedToday) used++;
        cont.innerHTML+=`
          <div class="player">
            <div class="player-info">
              <strong>${p.name}</strong>ï½œ${p.rating} ${ratingStars(p.rating)}ï½œ$${p.salary}M
              <br>ğŸ“ˆ è¨“ç·´é€²åº¦ï¼š${p.trainProgress}%${getNextRating(p.rating)?` â†’ ${getNextRating(p.rating)}`:""}
            </div>
            <button ${btnDisabled?"disabled":""} data-index="${i}">è¨“ç·´</button>
          </div>`;
      });
      cont.querySelectorAll("button[data-index]").forEach(btn=>{
        btn.onclick=()=>{
          const i=parseInt(btn.dataset.index),p=warriors[i];
          if(p.trainedToday) return;
          p.trainedToday=true; p.trainProgress=Math.min(100,p.trainProgress+Math.floor(Math.random()*20+10));
          let msg=`${p.name} è¨“ç·´å®Œæˆï¼ç›®å‰ ${p.trainProgress}%`;
          if(p.trainProgress>=100){
            const next=getNextRating(p.rating);
            if(next&&Math.random()<0.3){p.rating=next;msg+=` ğŸ‰ å‡ç´šç‚º ${p.rating}`;}
            else msg+=` ğŸ˜… æœªå‡ç´š`;
            p.trainProgress=0;
          }
          alert(msg); saveData(); renderDate(); showWarriors();
        };
      });
    }

    function showFreeAgents(){
      const cont=document.getElementById("freeAgentContainer");
      cont.innerHTML="<h2>ğŸ“ è‡ªç”±å¸‚å ´</h2>";
      freeAgents.forEach((p,i)=>{
        cont.innerHTML+=`
          <div class="player">
            <div class="player-info"><strong>${p.name}</strong>ï½œ${p.rating}ï½œ$${p.salary}M</div>
            <button data-i="${i}">ç°½ç´„</button>
          </div>`;
      });
      cont.querySelectorAll("button[data-i]").forEach(btn=>{
        btn.onclick=()=>{
          const i=parseInt(btn.dataset.i),p=freeAgents[i];
          if(money<p.salary){alert("ğŸ’¸ è³‡é‡‘ä¸è¶³");return;}
          if(Math.random()*100<=p.signChance){
            warriors.push({name:p.name,rating:p.rating,salary:p.salary,trainProgress:0,trainedToday:false});
            money-=p.salary;freeAgents.splice(i,1);
            alert(`${p.name} ç°½ç´„æˆåŠŸï¼`);
          } else alert(`${p.name} æ‹’çµ•åŠ å…¥`);
          saveData(); renderDate(); showWarriors(); showFreeAgents();
        };
      });
    }

    function showTrade(){
      const cont=document.getElementById("tradeContainer");
      cont.innerHTML="<h2>ğŸ”„ äº¤æ˜“ä¸­å¿ƒ (3æ›3)</h2>";
      Object.keys(otherTeams).forEach(team=>{
        cont.innerHTML+=`<button data-team="${team}">${team}</button>`;
      });
      cont.querySelectorAll("button[data-team]").forEach(btn=>{
        btn.onclick=()=>renderTradeUI(btn.dataset.team);
      });
    }

    function renderTradeUI(team){
      currentTradeTarget=team;
      const opp=otherTeams[team];
      const cont=document.getElementById("tradeContainer");
      cont.innerHTML=`<h2>äº¤æ˜“ï¼šå‹‡å£« â†” ${team}</h2>
        <div><strong>é¸æ“‡æœ€å¤š3ä½æˆ‘æ–¹çƒå“¡ï¼š</strong></div>`+
        warriors.map((p,i)=>`<label><input type="checkbox" data-side="my" value="${i}"> ${p.name}(${p.rating})</label><br>`).join("")+
        `<div><strong>æœ€å¤š3ä½å°æ–¹çƒå“¡ï¼š</strong></div>`+
        opp.map((p,i)=>`<label><input type="checkbox" data-side="their" value="${i}"> ${p.name}(${p.rating})</label><br>`).join("")+
        `<div><label><input type="checkbox" id="myPick"> æˆ‘å‡º1å¼µå‹‡å£«é¦–è¼ªç±¤</label>
         <label><input type="checkbox" id="theirPick"> è¦å°æ–¹1å¼µé¦–è¼ªç±¤</label></div>
         <button id="confirmTrade">æå‡ºäº¤æ˜“</button><div id="tradeMsg"></div>`;
      document.getElementById("confirmTrade").onclick=()=>{
        const mySel=[...cont.querySelectorAll('input[data-side="my"]:checked')].map(cb=>warriors[cb.value]);
        const theirSel=[...cont.querySelectorAll('input[data-side="their"]:checked')].map(cb=>opp[cb.value]);
        if(mySel.length>3||theirSel.length>3) return alert("æœ€å¤š3æ›3");
        let myVal=mySel.reduce((a,p)=>a+ratingMap[p.rating],0);
        let theirVal=theirSel.reduce((a,p)=>a+ratingMap[p.rating],0);
        if(cont.querySelector("#myPick").checked){ if(firstRoundPicks["å‹‡å£«"]<1)return alert("æ²’ç±¤å¯ä»¥çµ¦"); myVal+=4;}
        if(cont.querySelector("#theirPick").checked) theirVal+=4;
        if(myVal-theirVal>1) return document.getElementById("tradeMsg").textContent="å°æ–¹è¦ºå¾—ä¸å¤ ";
        if(theirVal-myVal>3) return document.getElementById("tradeMsg").textContent="å°æ–¹è¦ºå¾—å¤ªè™§";
        // æˆåŠŸ
        mySel.forEach(p=>warriors.splice(warriors.indexOf(p),1));
        theirSel.forEach(p=>warriors.push({name:p.name,rating:p.rating,salary:p.salary,trainProgress:0,trainedToday:false}));
        opp.forEach(p=>{});
        otherTeams[team]=opp.filter(p=>!theirSel.includes(p)).concat(mySel);
        if(cont.querySelector("#myPick").checked) firstRoundPicks["å‹‡å£«"]--;
        if(cont.querySelector("#theirPick").checked) firstRoundPicks["å‹‡å£«"]++;
        saveData(); renderDate(); showWarriors(); showTrade();
        document.getElementById("tradeMsg").textContent="äº¤æ˜“æˆåŠŸâœ…";
      };
    }

    function simulateGame(){
      const today=new Date().toDateString();
      if(lastSimDate===today) return alert("ä»Šå¤©å·²æ¨¡æ“¬é");
      const teams=Object.keys(otherTeams);
      const opp=otherTeams[teams[Math.floor(Math.random()*teams.length)]];
      const teamScore=warriors.reduce((a,p)=>a+ratingMap[p.rating]*(Math.random()+0.5),0);
      const oppScore=opp.reduce((a,p)=>a+ratingMap[p.rating]*(Math.random()+0.5),0);
      const mvp=warriors.reduce((best,p)=>{const s=ratingMap[p.rating]*(Math.random()+0.5);return s>(best.s||0)?{n:p.name,s}:best;},{});
      document.getElementById("gameResult").innerHTML=
        `<h2>ğŸ“Š æ¯”æ•¸çµæœ</h2><p>å‹‡å£« ${Math.round(teamScore)} : ${Math.round(oppScore)}</p><p>MVPï¼š${mvp.n}</p>`;
      lastSimDate=today; saveData(); renderDate();
    }

    function resetTraining(){
      warriors.forEach(p=>p.trainedToday=false);
      todayTrained=[]; alert("è¨“ç·´å·²é‡ç½®ï¼");
      saveData(); showWarriors();
    }

    function dailyCheck(){
      const t=new Date().toDateString(), ld=localStorage.getItem("lastDate");
      if(ld!==t){ warriors.forEach(p=>p.trainedToday=false); localStorage.setItem("lastDate",t); saveData(); renderDate();}
    }

    document.addEventListener("DOMContentLoaded",()=>{
      loadData(); dailyCheck(); renderDate(); showWarriors();
      document.getElementById("showWarriorsBtn").onclick=showWarriors;
      document.getElementById("showFreeAgentsBtn").onclick=showFreeAgents;
      document.getElementById("showTradeBtn").onclick=showTrade;
      document.getElementById("simulateGameBtn").onclick=simulateGame;
      document.getElementById("resetTrainingBtn").onclick=resetTraining;
      document.getElementById("clearBtn").onclick=()=>{localStorage.clear();location.reload();};
      setInterval(dailyCheck,60000);
    });
  })();
  </script>
</body>
</html>