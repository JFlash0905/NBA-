<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>ğŸ€ Sniper J GM æ¨¡æ“¬å™¨ v0.9.0 Ultimate+</title>
  <style>
    body { font-family: sans-serif; padding: 20px; background: #f2f2f2; }
    h1 { color: #2c3e50; }
    button { margin:5px; padding:10px; font-size:16px; border-radius:5px; cursor:pointer; background:#3498db; color:white; border:none; }
    button:disabled { background:#aaa; cursor:not-allowed; }
    .player { background:white; margin:10px 0; padding:10px; border-radius:6px; display:flex; justify-content:space-between; align-items:center; }
    .player-info { flex-grow:1; }
    .progress-bar { width:100%; background:#ddd; height:8px; border-radius:4px; overflow:hidden; margin-top:4px; }
    .progress-bar-inner { height:100%; background:#4caf50; width:0%; }
    .section { margin-top:30px; }
    .container { max-width:900px; margin:auto; }
    label { display:block; margin:2px 0; }
    select, input[type=text] { padding:4px; margin:4px 0; }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ€ Sniper J GM æ¨¡æ“¬å™¨ v0.9.0 Ultimate+</h1>
    <div>
      <button id="clearBtn">æ¸…ç©ºå­˜æª”</button>
      <span id="dateDisplay"></span>
      <div id="moneyDisplay"></div>
    </div>
    <div class="section">
      <button id="showWarriorsBtn">å‹‡å£«é™£å®¹</button>
      <button id="showFreeAgentsBtn">è‡ªç”±å¸‚å ´</button>
      <button id="showTradeBtn">äº¤æ˜“ä¸­å¿ƒ</button>
      <button id="simulateGameBtn">æ¨¡æ“¬æ¯”è³½</button>
      <button id="resetTrainingBtn">é‡ç½®è¨“ç·´</button>
    </div>
    <div id="teamContainer"></div>
    <div id="freeAgentContainer"></div>
    <div id="tradeContainer"></div>
    <div id="gameResult"></div>
  </div>

<script>
(() => {
  const ratingMap = {"C":1,"C+":2,"B-":3,"B":4,"B+":5,"A-":6,"A":7,"A+":8,"S":9,"S+":10};
  const order = ["C","C+","B-","B","B+","A-","A","A+","S","S+"];
  const ratingStars = r => "â˜…".repeat(Math.min(5, Math.round(ratingMap[r]/2)));

  let warriors, freeAgents, otherTeams, money, salaryCap, lastDate, firstRoundPicks, trainLimit, todayTrained, currentTradeTarget;

  function defaultData(){
    return {
      warriors:[
        {name:"Stephen Curry",rating:"S",salary:35,trainProgress:0},
        {name:"Klay Thompson",rating:"B+",salary:20,trainProgress:0},
        {name:"Draymond Green",rating:"B",salary:18,trainProgress:0},
        {name:"Jonathan Kuminga",rating:"B",salary:15,trainProgress:0},
        {name:"Andrew Wiggins",rating:"B+",salary:22,trainProgress:0},
        {name:"Moses Moody",rating:"C+",salary:10,trainProgress:0},
        {name:"Gary Payton II",rating:"C+",salary:9,trainProgress:0},
        {name:"Brandin Podziemski",rating:"B-",salary:11,trainProgress:0},
        {name:"Kevon Looney",rating:"C",salary:8,trainProgress:0},
      ],
      freeAgents:[
        {name:"Malik Beasley",rating:"B",salary:15,signChance:60},
        {name:"Robert Covington",rating:"B-",salary:12,signChance:50},
        {name:"Dennis Smith Jr.",rating:"B-",salary:9,signChance:55},
        {name:"Justise Winslow",rating:"C+",salary:7,signChance:45},
        {name:"Tristan Thompson",rating:"C",salary:6,signChance:50},
      ],
      otherTeams:{
        "é›·éœ†":[
          {name:"Shai Gilgeousâ€‘Alexander",rating:"S",salary:34},
          {name:"Jalen Williams",rating:"A",salary:20},
          {name:"Chet Holmgren",rating:"A-",salary:18},
          {name:"Josh Giddey",rating:"B+",salary:16},
          {name:"Lu Dort",rating:"B",salary:14},
          {name:"Isaiah Joe",rating:"B-",salary:10}
        ],
        "é‡‘å¡Š":[
          {name:"Nikola Jokic",rating:"S+",salary:38},
          {name:"Jamal Murray",rating:"A",salary:27},
          {name:"Aaron Gordon",rating:"B+",salary:24},
          {name:"Michael Porter Jr.",rating:"B+",salary:22},
          {name:"Kentavious Caldwellâ€‘Pope",rating:"B",salary:15},
          {name:"Reggie Jackson",rating:"B-",salary:10}
        ]
      },
      money:100,
      salaryCap:120,
      lastDate:null,
      firstRoundPicks:{"å‹‡å£«":2,"é›·éœ†":2,"é‡‘å¡Š":2},
      trainLimit:5
    };
  }

  function load(){
    const s = JSON.parse(localStorage.getItem("gm_v090")||"null");
    if(s) Object.assign(window, s);
    else Object.assign(window, defaultData());
    todayTrained = [];
  }
  function save(){
    const toSave = {warriors, freeAgents, otherTeams, money, salaryCap, lastDate, firstRoundPicks, trainLimit};
    localStorage.setItem("gm_v090", JSON.stringify(toSave));
  }

  function autoReset(){
    const d = new Date().toDateString();
    if(lastDate !== d){
      warriors.forEach(p=>p.trainedToday=false);
      lastDate = d;
      save();
    }
  }

  function renderDate(){
    const d = new Date().toLocaleDateString();
    const sal = warriors.reduce((a,p)=>a+p.salary,0);
    document.getElementById("dateDisplay").textContent = "ï½œä»Šå¤©ï¼š" + d;
    document.getElementById("moneyDisplay").textContent = 
      `ï½œè³‡é‡‘ï¼š$${money}Mï½œå·¥è³‡ï¼š${sal}M / ${salaryCap}M${sal>salaryCap?" âš ï¸":""}ï½œé¦–è¼ªç±¤ï¼š${firstRoundPicks["å‹‡å£«"]} å¼µ`;
  }

  function getNext(r){ return order[order.indexOf(r)+1]||null; }
  function tryUpgrade(r){ return Math.random()<0.3; }

  function showWarriors(){
    document.getElementById("teamContainer").innerHTML = "";
    const d = document.createElement("div");
    d.innerHTML = "<h2>ğŸ€ å‹‡å£«é™£å®¹</h2>";
    let cnt=0;
    warriors.forEach((p,i)=>{
      const div = document.createElement("div");
      div.className = "player";
      const prog = p.trainProgress + "%";
      div.innerHTML = `
        <div class="player-info">
          <strong>${p.name}</strong>ï½œ${p.rating} ${ratingStars(p.rating)}ï½œ$${p.salary}M<br/>
          ğŸ“ˆ é€²åº¦ï¼š${prog} ${getNext(p.rating)?`(ç›®æ¨™ï¼š${getNext(p.rating)})`: ''}
        </div>
        <button ${p.trainedToday|| cnt>=trainLimit? "disabled": ""}>è¨“ç·´</button>`;
      const btn = div.querySelector("button");
      btn.onclick = ()=>{
        if(p.trainedToday || cnt>=trainLimit) return;
        p.trainedToday = true;
        cnt+=1;
        p.trainProgress = Math.min(100, p.trainProgress + Math.floor(Math.random()*20+10));
        let msg = `${p.name} è¨“ç·´ ${p.trainProgress}%ï¼`;
        if(p.trainProgress>=100){
          if(tryUpgrade(p.rating) && getNext(p.rating)){
            p.rating = getNext(p.rating);
            msg += ` å‡ç´šæˆåŠŸï¼è®Šæˆ ${p.rating}`;
          } else msg += " ä½†æœªå‡ç´šï¼Œè«‹ç¹¼çºŒåŠªåŠ›";
          p.trainProgress=0;
        }
        alert(msg);
        save(); renderDate(); showWarriors();
      };
      d.appendChild(div);
    });
    document.getElementById("teamContainer").appendChild(d);
  }

  function showFree(){
    const cont = document.getElementById("freeAgentContainer");
    cont.innerHTML = "<h2>ğŸ“ è‡ªç”±å¸‚å ´</h2>";
    freeAgents.forEach((p,i)=>{
      const div = document.createElement("div");
      div.className="player";
      div.innerHTML = `
        <div class="player-info">
          <strong>${p.name}</strong>ï½œ${p.rating} ${ratingStars(p.rating)}ï½œ$${p.salary}M
        </div>
        <button>ç°½ç´„</button>`;
      const btn = div.querySelector("button");
      btn.onclick = ()=>{
        if(money < p.salary) return alert("è³‡é‡‘ä¸è¶³");
        if(Math.random()*100 < p.signChance){
          warriors.push({ ...p, trainProgress:0, trainedToday:false });
          money -= p.salary;
          freeAgents.splice(i,1);
          alert(`${p.name} åŠ å…¥æˆåŠŸ`);
        } else alert(`${p.name} æ‹’çµ•ç°½ç´„`);
        save(); renderDate(); showFree(); showWarriors();
      };
      cont.appendChild(div);
    });
  }

  function showTradeCenter(){
    const cont = document.getElementById("tradeContainer");
    cont.innerHTML = "<h2>ğŸ” äº¤æ˜“ä¸­å¿ƒ</h2>";
    Object.keys(otherTeams).forEach(team=>{
      const btn = document.createElement("button");
      btn.textContent = team;
      btn.onclick = ()=> tradeUI(team);
      cont.appendChild(btn);
    });
  }

  function tradeUI(team){
    currentTradeTarget = team;
    const opp = otherTeams[team];
    const cont = document.getElementById("tradeContainer");
    cont.innerHTML = `<h2>ğŸ” èˆ‡ ${team} äº¤æ˜“</h2>
      <p>æœ€å¤šä¸‰æ›ä¸‰ï¼Œå¯é¸é¦–è¼ªç±¤</p>`;
    const form = document.createElement("div");
    form.innerHTML = "<strong>é¸æ“‡æˆ‘æ–¹çƒå“¡ï¼š</strong><br/>" +
      warriors.map((p,i)=> `<label><input data-type="my" type="checkbox" value="${i}"> ${p.name} (${p.rating})</label>`).join("") +
      `<br/><label><input type="checkbox" id="myPick"> åŠ å…¥æˆ‘æ–¹é¦–è¼ªç±¤</label><br/><hr>` +
      "<strong>å°æ–¹çƒå“¡ï¼š</strong><br/>" +
      opp.map((p,i)=> `<label><input data-type="their" type="checkbox" value="${i}"> ${p.name} (${p.rating})</label>`).join("") +
      `<br/><label><input type="checkbox" id="theirPick"> è¦æ±‚å°æ–¹é¦–è¼ªç±¤</label><br/><br/>` +
      `<button id="submitTrade">æå‡ºäº¤æ˜“</button>` +
      `<div id="tradeMsg"></div>`;
    cont.appendChild(form);

    form.querySelector("#submitTrade").onclick = ()=>{
      const mySel = [...form.querySelectorAll('input[data-type="my"]:checked')].map(cb=>+cb.value);
      const theirSel = [...form.querySelectorAll('input[data-type="their"]:checked')].map(cb=>+cb.value);
      if(mySel.length>3||theirSel.length>3) return alert("æœ€å¤š 3 æ› 3");
      let myVal=mySel.reduce((s,i)=>s+ratingMap[warriors[i].rating],0);
      let theirVal=theirSel.reduce((s,i)=>s+ratingMap[opp[i].rating],0);
      if(form.querySelector("#myPick").checked){
        if(firstRoundPicks["å‹‡å£«"]<=0) return alert("æ²’æœ‰ç±¤å¯äº¤æ˜“");
        myVal+=4;
      }
      if(form.querySelector("#theirPick").checked) theirVal+=4;
      const diff=myVal-theirVal;
      let msg="";
      if(diff>=2) msg="âŒ å°æ–¹è¦ºå¾—ä½ çš„æ–¹æ¡ˆä¸å¤ ";
      else if(diff<=-4) msg="âŒ å°æ–¹è¦ºå¾—è³ å¤ªå¤š";
      else {
        msg="âœ… äº¤æ˜“æˆåŠŸ";
        if(form.querySelector("#myPick").checked) firstRoundPicks["å‹‡å£«"]--;
        if(form.querySelector("#theirPick").checked) firstRoundPicks["å‹‡å£«"]++;
        const myTrade= mySel.map(i=>warriors[i]);
        const theirTrade= theirSel.map(i=>opp[i]);
        warriors = warriors.filter((_,i)=>!mySel.includes(i)).concat(theirTrade.map(p=>({...p, trainProgress:0, trainedToday:false}));
        otherTeams[team] = opp.filter((_,i)=>!theirSel.includes(i)).concat(myTrade);
        save(); renderDate(); showWarriors(); showTradeCenter();
      }
      form.querySelector("#tradeMsg").textContent = msg;
    };
  }

  function simulate(){
    const d = new Date().toDateString();
    if(lastDate===d) return alert("ä»Šå¤©å·²æ¨¡æ“¬é");
    const teamNames=Object.keys(otherTeams);
    const targ=teamNames[Math.floor(Math.random()*teamNames.length)];
    const opp=otherTeams[targ];
    let ts = warriors.reduce((s,p)=>s + ratingMap[p.rating]*(Math.random()+0.5),0);
    let os = opp.reduce((s,p)=>s + ratingMap[p.rating]*(Math.random()+0.5),0);
    let mvp = warriors.reduce((best,p)=>{
      let sc = ratingMap[p.rating]*(Math.random()+0.5);
      return sc>best.score?{name:p.name,score:sc}:best;
    },{name:"",score:0});
    document.getElementById("gameResult").innerHTML = `<h2>ğŸ“Š æ¯”è³½çµæœ</h2><p>å‹‡å£« ${Math.round(ts)} : ${Math.round(os)} ${targ}</p><p>ğŸ– MVPï¼š${mvp.name}</p>`;
    lastDate=d; save(); renderDate();
  }

  document.addEventListener("DOMContentLoaded",()=>{
    load(); autoReset(); renderDate();
    showWarriors(); showFree(); showTradeCenter();
    document.getElementById("showWarriorsBtn").onclick=showWarriors;
    document.getElementById("showFreeAgentsBtn").onclick=showFree;
    document.getElementById("showTradeBtn").onclick=showTradeCenter;
    document.getElementById("simulateGameBtn").onclick=simulate;
    document.getElementById("resetTrainingBtn").onclick=()=>{todayTrained=[]; warriors.forEach(p=>p.trainedToday=false); save(); showWarriors();};
    document.getElementById("clearBtn").onclick=()=>{if(confirm("æ¸…é™¤ï¼Ÿ")){localStorage.clear();location.reload();}};
  });
})();
</script>
</body></html>