<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>🏀 Sniper J GM 模擬器 v0.9.2 Lite+</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: sans-serif;
      background: #f4f4f4;
      padding: 10px;
      margin: 0;
    }
    h1, h2 {
      text-align: center;
      color: #2c3e50;
    }
    button {
      display: block;
      width: 100%;
      margin: 5px 0;
      padding: 12px;
      font-size: 18px;
      border-radius: 8px;
      border: none;
      background: #3498db;
      color: white;
      cursor: pointer;
    }
    button:disabled {
      background: #ccc;
      cursor: not-allowed;
    }
    .container {
      max-width: 500px;
      margin: auto;
    }
    .player {
      background: white;
      margin: 10px 0;
      padding: 10px;
      border-radius: 6px;
    }
    .player-info {
      margin-bottom: 5px;
    }
    #versionFooter {
      text-align: center;
      margin-top: 30px;
      font-size: 14px;
      color: #888;
    }
  </style>
</head>
<body>
<div class="container">
  <h1>🏀 Sniper J GM 模擬器</h1>
  <button id="showWarriorsBtn">勇士陣容</button>
  <button id="showFreeAgentsBtn">自由市場</button>
  <button id="showTradeBtn">交易中心</button>
  <button id="simulateGameBtn">模擬比賽</button>
  <button id="resetTrainingBtn">重置訓練</button>
  <button id="clearBtn">清空存檔</button>
  <div id="dateDisplay"></div>
  <div id="moneyDisplay"></div>
  <div id="teamDisplay"></div>
  <div id="freeAgentsDisplay"></div>
  <div id="tradeDisplay"></div>
  <div id="gameResult"></div>
  <div id="versionFooter">版本 v0.9.2 Lite+</div>
</div>

<script>
(() => {
  const ratingMap = {"C":1,"C+":2,"B-":3,"B":4,"B+":5,"A-":6,"A":7,"A+":8,"S":9,"S+":10};
  const order = ["C","C+","B-","B","B+","A-","A","A+","S","S+"];
  let warriors, freeAgents, otherTeams, money, salaryCap, lastDate, picks, trainLimit;

  function defaultData() {
    return {
      warriors:[
        {name:"Stephen Curry",rating:"S",salary:35,trainProgress:0,trained:false},
        {name:"Klay Thompson",rating:"B+",salary:20,trainProgress:0,trained:false},
        {name:"Jonathan Kuminga",rating:"B",salary:15,trainProgress:0,trained:false}
      ],
      freeAgents:[
        {name:"Malik Beasley",rating:"B",salary:15,signChance:60},
        {name:"Robert Covington",rating:"B-",salary:12,signChance:50}
      ],
      otherTeams:{
        "雷霆":[{name:"SGA",rating:"S",salary:34},{name:"Jalen Williams",rating:"A",salary:20}]
      },
      money:100, salaryCap:140, lastDate:null,
      picks:{"勇士":2,"雷霆":2},
      trainLimit:3
    };
  }

  function load(){
    const s = localStorage.getItem("sj_gm_lite");
    if(s) Object.assign(window, JSON.parse(s));
    else Object.assign(window, defaultData());
  }

  function save(){
    localStorage.setItem("sj_gm_lite", JSON.stringify({
      warriors, freeAgents, otherTeams, money, salaryCap, lastDate, picks, trainLimit
    }));
  }

  function renderStatus(){
    const now = new Date().toLocaleDateString();
    const sal = warriors.reduce((a, p) => a + p.salary, 0);
    document.getElementById("dateDisplay").textContent = "今天：" + now;
    document.getElementById("moneyDisplay").textContent = `資金:$${money}M 工資:${sal}/${salaryCap}M 首輪籤:${picks["勇士"]}`;
  }

  function showWarriors(){
    const out = document.getElementById("teamDisplay");
    out.innerHTML = "<h2>🏀 勇士陣容</h2>";
    let trainedCount = warriors.filter(p => p.trained).length;
    warriors.forEach((p, i) => {
      const next = order[order.indexOf(p.rating)+1] || "MAX";
      out.innerHTML += `
        <div class="player">
          <div class="player-info"><b>${p.name}</b>｜${p.rating}｜$${p.salary}M<br>訓練進度: ${p.trainProgress}% → ${next}</div>
          <button ${p.trained || trainedCount >= trainLimit ? "disabled" : ""} onclick="trainPlayer(${i})">訓練</button>
        </div>`;
    });
  }

  window.trainPlayer = (i) => {
    const p = warriors[i];
    if(p.trained) return;
    p.trainProgress += Math.floor(10 + Math.random() * 10);
    p.trained = true;
    if(p.trainProgress >= 100){
      p.trainProgress = 0;
      if(Math.random() < 0.3){
        const idx = order.indexOf(p.rating);
        if(idx < order.length - 1){
          p.rating = order[idx + 1];
          alert(p.name + " 升級為 " + p.rating + "！");
        }
      }
    }
    save(); renderStatus(); showWarriors();
  };

  function showFreeAgents(){
    const out = document.getElementById("freeAgentsDisplay");
    out.innerHTML = "<h2>📝 自由市場</h2>";
    freeAgents.forEach((p, i) => {
      out.innerHTML += `
        <div class="player">
          <div class="player-info"><b>${p.name}</b>｜${p.rating}｜$${p.salary}M</div>
          <button onclick="signFreeAgent(${i})">簽約</button>
        </div>`;
    });
  }

  window.signFreeAgent = (i) => {
    const p = freeAgents[i];
    if(money < p.salary) return alert("資金不足！");
    if(Math.random()*100 < p.signChance){
      warriors.push({...p, trainProgress:0, trained:false});
      freeAgents.splice(i,1);
      money -= p.salary;
      alert(p.name + " 成功簽下！");
    } else {
      alert(p.name + " 拒絕簽約");
    }
    save(); renderStatus(); showWarriors(); showFreeAgents();
  };

  function simulateGame(){
    const today = new Date().toDateString();
    if (lastDate === today) return alert("今日已模擬");
    const opp = otherTeams["雷霆"];
    const ts = warriors.reduce((a, p) => a + ratingMap[p.rating] * (Math.random() + 0.5), 0);
    const os = opp.reduce((a, p) => a + ratingMap[p.rating] * (Math.random() + 0.5), 0);
    const mvp = warriors.reduce((b, p) => {
      const s = ratingMap[p.rating] * (Math.random()+0.5);
      return s > b.score ? {name: p.name, score: s} : b;
    }, {name:"", score:0});
    document.getElementById("gameResult").innerHTML =
      `<h2>🏀 比分：${Math.floor(ts)} : ${Math.floor(os)}</h2><p>MVP：${mvp.name}</p>`;
    lastDate = today; save(); renderStatus();
  }

  function resetTraining(){
    warriors.forEach(p => p.trained = false);
    alert("訓練狀態已重置");
    save(); showWarriors();
  }

  document.addEventListener("DOMContentLoaded", () => {
    load(); renderStatus(); showWarriors();
    document.getElementById("showWarriorsBtn").onclick = showWarriors;
    document.getElementById("showFreeAgentsBtn").onclick = showFreeAgents;
    document.getElementById("simulateGameBtn").onclick = simulateGame;
    document.getElementById("resetTrainingBtn").onclick = resetTraining;
    document.getElementById("clearBtn").onclick = () => {
      if(confirm("清除存檔？")) { localStorage.clear(); location.reload(); }
    };
  });
})();
</script>
</body>
</html>