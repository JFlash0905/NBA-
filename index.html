<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>Sniper J GM 模擬器 v0.9.0 Ultimate+</title>
  <style>
    body { font-family: sans-serif; background: #f0f0f0; padding: 20px; }
    h1 { color: #2c3e50; }
    button { margin:5px;padding:10px;font-size:16px;border-radius:5px;cursor:pointer;background:#3498db;color:#fff;border:none; }
    button:disabled { background:#aaa; cursor:not-allowed; }
    .player { background:#fff;margin:10px 0;padding:10px;border-radius:6px;display:flex;align-items:center;justify-content:space-between; }
    .player-info { flex-grow:1; }
    .container { max-width:900px; margin:auto; }
    .section { margin-top:30px; }
  </style>
</head>
<body>
  <div class="container">
    <h1>🏀 Sniper J GM 模擬器 v0.9.0 Ultimate+</h1>
    <div>
      <button id="clearBtn">清空存檔</button>
      <span id="dateDisplay"></span>
      <div id="moneyDisplay"></div>
    </div>
    <div class="section">
      <button id="showWarriorsBtn">勇士陣容</button>
      <button id="showFreeAgentsBtn">自由市場</button>
      <button id="showTradeBtn">交易中心</button>
      <button id="simulateGameBtn">模擬比賽</button>
      <button id="resetTrainingBtn">重置訓練</button>
    </div>
    <div id="teamDisplay"></div>
    <div id="freeAgentsDisplay"></div>
    <div id="tradeDisplay"></div>
    <div id="gameResult"></div>
  </div>

  <script>
    window.addEventListener("DOMContentLoaded", () => {
      const ratingMap = {"C":1,"C+":2,"B-":3,"B":4,"B+":5,"A-":6,"A":7,"A+":8,"S":9,"S+":10};
      const order = ["C","C+","B-","B","B+","A-","A","A+","S","S+"];

      let warriors, freeAgents, otherTeams, money, salaryCap, lastDate, picks, trainLimit;

      function defaultData() {
        return {
          warriors: [
            {name:"Stephen Curry",rating:"S",salary:35,trainProgress:0,trained:false},
            {name:"Klay Thompson",rating:"B+",salary:20,trainProgress:0,trained:false},
            {name:"Draymond Green",rating:"B",salary:18,trainProgress:0,trained:false}
          ],
          freeAgents: [
            {name:"Malik Beasley",rating:"B",salary:15,signChance:60},
            {name:"Robert Covington",rating:"B-",salary:12,signChance:50}
          ],
          otherTeams: {
            "雷霆":[
              {name:"SGA",rating:"S",salary:34},
              {name:"Jalen Williams",rating:"A",salary:20}
            ],
            "金塊":[
              {name:"Jokic",rating:"S+",salary:38},
              {name:"Jamal Murray",rating:"A",salary:27}
            ]
          },
          money:100, salaryCap:120, lastDate:null,
          picks:{"勇士":2,"雷霆":2,"金塊":2}, trainLimit:5
        };
      }

      function load() {
        const s = localStorage.getItem("sj_v090");
        if (s) Object.assign(window, JSON.parse(s));
        else Object.assign(window, defaultData());
      }

      function save() {
        localStorage.setItem("sj_v090", JSON.stringify({warriors, freeAgents, otherTeams, money, salaryCap, lastDate, picks, trainLimit}));
      }

      function renderStatus() {
        const now = new Date().toLocaleDateString();
        const sal = warriors.reduce((a,p)=>a+p.salary,0);
        document.getElementById("dateDisplay").textContent = "今天：" + now;
        document.getElementById("moneyDisplay").textContent = `資金：$${money}M　工資：${sal}/${salaryCap}M　首輪籤：${picks["勇士"]}`;
      }

      function showWarriors() {
        const out = document.getElementById("teamDisplay");
        out.innerHTML = "<h2>勇士陣容</h2>";
        let trainedCount = warriors.filter(p=>p.trained).length;
        warriors.forEach((p,i) => {
          out.innerHTML += `
            <div class="player">
              <div class="player-info">
                <strong>${p.name}</strong>｜${p.rating}｜★${"★".repeat(Math.min(5,Math.round(ratingMap[p.rating]/2)))}｜$${p.salary}M<br>
                訓練進度：${p.trainProgress}%
              </div>
              <button ${p.trained || trainedCount >= trainLimit ? "disabled" : ""} data-idx="${i}">訓練</button>
            </div>`;
        });
        out.querySelectorAll("button").forEach(btn => {
          btn.onclick = () => {
            const i = +btn.getAttribute("data-idx");
            const p = warriors[i];
            p.trained = true;
            p.trainProgress += Math.floor(Math.random()*10+10);
            if (p.trainProgress >= 100) {
              const idx = order.indexOf(p.rating);
              if (idx < order.length - 1 && Math.random() < 0.3) {
                p.rating = order[idx+1];
                alert(`${p.name} 升級到 ${p.rating}！`);
              }
              p.trainProgress = 0;
            }
            save(); showWarriors(); renderStatus();
          };
        });
      }

      function showFreeAgents() {
        const out = document.getElementById("freeAgentsDisplay");
        out.innerHTML = "<h2>自由市場</h2>";
        freeAgents.forEach((p,i)=>{
          out.innerHTML += `
            <div class="player">
              <div class="player-info">${p.name}｜${p.rating}｜$${p.salary}M</div>
              <button data-idx="${i}">簽約</button>
            </div>`;
        });
        out.querySelectorAll("button").forEach(btn=>{
          btn.onclick = () => {
            const i = +btn.getAttribute("data-idx");
            const p = freeAgents[i];
            if (money < p.salary) return alert("資金不足！");
            if (Math.random()*100 < p.signChance) {
              warriors.push({name:p.name, rating:p.rating, salary:p.salary, trainProgress:0, trained:false});
              money -= p.salary;
              freeAgents.splice(i,1);
              alert("簽約成功！");
            } else alert("簽約失敗");
            save(); showWarriors(); showFreeAgents(); renderStatus();
          };
        });
      }

      function resetTraining() {
        warriors.forEach(p => p.trained = false);
        alert("已重置今日訓練狀態！");
        save(); showWarriors();
      }

      function simulateGame() {
        const today = new Date().toDateString();
        if (lastDate === today) return alert("今日已模擬！");
        const teams = Object.values(otherTeams);
        const opp = teams[Math.floor(Math.random()*teams.length)];
        const myScore = warriors.reduce((a,p)=>a + ratingMap[p.rating]*(Math.random()+0.5),0);
        const oppScore = opp.reduce((a,p)=>a + ratingMap[p.rating]*(Math.random()+0.5),0);
        const mvp = warriors[Math.floor(Math.random()*warriors.length)].name;
        document.getElementById("gameResult").innerHTML = `<h2>比分 ${Math.round(myScore)} : ${Math.round(oppScore)}</h2><p>MVP：${mvp}</p>`;
        lastDate = today;
        save(); renderStatus();
      }

      document.getElementById("showWarriorsBtn").onclick = showWarriors;
      document.getElementById("showFreeAgentsBtn").onclick = showFreeAgents;
      document.getElementById("simulateGameBtn").onclick = simulateGame;
      document.getElementById("resetTrainingBtn").onclick = resetTraining;
      document.getElementById("clearBtn").onclick = () => {
        if (confirm("是否清除所有資料？")) {
          localStorage.clear(); location.reload();
        }
      };

      load(); renderStatus(); showWarriors();
    });
  </script>
</body>
</html>