<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>ğŸ€ Sniperâ€¯J GM æ¨¡æ“¬å™¨ v0.9.0 Ultimate+</title>
  <style>
    body { font-family: sans-serif; padding: 20px; background: #f2f2f2; }
    h1 { color: #2c3e50; }
    button { margin:5px;padding:10px;font-size:16px;border-radius:5px;cursor:pointer;background:#3498db;color:#fff;border:none; }
    button:disabled { background:#aaa; cursor:not-allowed; }
    .player { background:#fff;margin:10px 0;padding:10px;border-radius:6px;display:flex;align-items:center;justify-content:space-between; }
    .player-info { flex-grow:1; }
    .progress-bar { width:100%; background:#ddd; border-radius:4px; overflow:hidden; height:8px; margin-top:4px; }
    .container { max-width:900px; margin:auto; }
    .section { margin-top:30px; }
    input[type="checkbox"] { margin-right:5px; }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ€ Sniperâ€¯J GM æ¨¡æ“¬å™¨ v0.9.0 Ultimate+</h1>
    <div>
      <button id="clearBtn">æ¸…ç©ºå­˜æª”</button>
      <span id="dateDisplay"></span>
      <div id="moneyDisplay"></div>
    </div>
    <div class="section">
      <button id="showWarriorsBtn">å‹‡å£«é™£å®¹</button>
      <button id="showFreeAgentsBtn">è‡ªç”±å¸‚å ´</button>
      <button id="showTradeBtn">äº¤æ˜“ä¸­å¿ƒ</button>
      <button id="simulateGameBtn">æ¨¡æ“¬æ¯”è³½</button>
      <button id="resetTrainingBtn">é‡ç½®è¨“ç·´</button>
    </div>
    <div id="teamDisplay"></div>
    <div id="freeAgentsDisplay"></div>
    <div id="tradeDisplay"></div>
    <div id="gameResult"></div>
  </div>
    <script>
(() => {
  const ratingMap = {"C":1,"C+":2,"B-":3,"B":4,"B+":5,"A-":6,"A":7,"A+":8,"S":9,"S+":10};
  const order = ["C","C+","B-","B","B+","A-","A","A+","S","S+"];

  let warriors, freeAgents, otherTeams, money, salaryCap, lastDate, picks, trainLimit;

  function defaultData() {
    return {
      warriors:[
        {name:"Stephen Curry",rating:"S",salary:35,trainProgress:0,trained:false},
        {name:"Klay Thompson",rating:"B+",salary:20,trainProgress:0,trained:false},
        {name:"Draymond Green",rating:"B",salary:18,trainProgress:0,trained:false},
        {name:"Jonathan Kuminga",rating:"B",salary:15,trainProgress:0,trained:false},
        {name:"Andrew Wiggins",rating:"B+",salary:22,trainProgress:0,trained:false},
        {name:"Moses Moody",rating:"C+",salary:10,trainProgress:0,trained:false},
        {name:"Gary Payton II",rating:"C+",salary:9,trainProgress:0,trained:false},
        {name:"Brandin Podziemski",rating:"B-",salary:11,trainProgress:0,trained:false},
        {name:"Kevon Looney",rating:"C",salary:8,trainProgress:0,trained:false}
      ],
      freeAgents:[
        {name:"Malik Beasley",rating:"B",salary:15,signChance:60},
        {name:"Robert Covington",rating:"B-",salary:12,signChance:50},
        {name:"Dennis Smith Jr.",rating:"B-",salary:9,signChance:55},
        {name:"Justise Winslow",rating:"C+",salary:7,signChance:45},
        {name:"Tristan Thompson",rating:"C",salary:6,signChance:50}
      ],
      otherTeams:{
        "é›·éœ†":[
          {name:"Shai Gilgeousâ€‘Alexander",rating:"S",salary:34},
          {name:"Jalen Williams",rating:"A",salary:20},
          {name:"Chet Holmgren",rating:"A-",salary:18}
        ],
        "é‡‘å¡Š":[
          {name:"Nikola Jokic",rating:"S+",salary:38},
          {name:"Jamal Murray",rating:"A",salary:27},
          {name:"Aaron Gordon",rating:"B+",salary:24}
        ]
      },
      money:100,salaryCap:120,lastDate:null,
      picks:{"å‹‡å£«":2,"é›·éœ†":2,"é‡‘å¡Š":2},
      trainLimit:5
    };
  }

  function load() {
    const s=localStorage.getItem("sj_v090");
    if(s) Object.assign(window,JSON.parse(s));
    else Object.assign(window,defaultData());
    lastDate = window.lastDate;
  }

  function save(){
    window.lastDate = lastDate;
    localStorage.setItem("sj_v090", JSON.stringify({
      warriors, freeAgents, otherTeams, money, salaryCap, lastDate, picks, trainLimit
    }));
  }

  function renderStatus(){
    const now=new Date().toLocaleDateString();
    const sal=warriors.reduce((a,p)=>a+p.salary,0);
    document.getElementById("dateDisplay").textContent="ä»Šå¤©ï¼š"+now;
    document.getElementById("moneyDisplay").textContent= `è³‡é‡‘:$${money}M å·¥è³‡:${sal}/${salaryCap}M  é¦–è¼ªç±¤:${picks["å‹‡å£«"]}`;
  }
    function showWarriors(){
    const out = document.getElementById("teamDisplay");
    let trainedCount = warriors.filter(p=>p.trained).length;
    out.innerHTML="<h2>ğŸ€ å‹‡å£«é™£å®¹</h2>";
    warriors.forEach((p,i)=>{
      const pct=p.trainProgress;
      const next = order[order.indexOf(p.rating)+1]||"MAX";
      out.innerHTML += `
      <div class=player>
        <div class=player-info>
          <strong>${p.name}</strong>ï½œ${p.rating}ï½œ${"â˜…".repeat(Math.min(5,Math.round(ratingMap[p.rating]/2)))}ï½œ$${p.salary}M<br>
          è¨“ç·´:${pct}% (ç›®æ¨™${next})
        </div>
        <button ${p.trained||trainedCount>=trainLimit?"disabled":""} data-idx=${i}>è¨“ç·´</button>
      </div>`;
    });
    out.querySelectorAll("button").forEach(btn=>{
      btn.onclick = ()=>{
        const i=+btn.getAttribute("data-idx");
        const p=warriors[i];
        if(p.trained) return;
        p.trainProgress = Math.min(100,p.trainProgress + (10+Math.random()*10)|0);
        p.trained=true;
        trainedCount++;
        if(p.trainProgress>=100){
          p.trainProgress=0;
          if(Math.random()<0.3){
            const ord=order.indexOf(p.rating);
            if(ord<order.length-1){
              p.rating=order[ord+1];
              alert(p.name+" å‡ç´šåˆ° "+p.rating+"ï¼");
            }
          }
        }
        save(); renderStatus(); showWarriors();
      };
    });
  }

  function showFreeAgents(){
    const out=document.getElementById("freeAgentsDisplay");
    out.innerHTML="<h2>ğŸ“ è‡ªç”±å¸‚å ´</h2>";
    freeAgents.forEach((p,i)=>{
      out.innerHTML+=`
      <div class=player>
        <div class=player-info><strong>${p.name}</strong>ï½œ${p.rating}ï½œ$${p.salary}M</div>
        <button data-idx=${i}>ç°½ç´„</button>
      </div>`;
    });
    out.querySelectorAll("button").forEach(btn=>{
      btn.onclick=()=>{
        const i=+btn.getAttribute("data-idx"), p=freeAgents[i];
        if(money<p.salary){ alert("è³‡é‡‘ä¸è¶³ï¼"); return; }
        if(Math.random()*100<p.signChance){
          warriors.push({name:p.name,rating:p.rating,salary:p.salary,trainProgress:0,trained:false});
          money-=p.salary;
          freeAgents.splice(i,1);
          alert(p.name+" æˆåŠŸç°½ç´„ï¼");
        } else alert(p.name+" æ‹’çµ•ç°½ç´„");
        save(); showWarriors(); showFreeAgents(); renderStatus();
      };
    });
  }

  function showTrade(){
    const out=document.getElementById("tradeDisplay");
    out.innerHTML="<h2>ğŸ”„ äº¤æ˜“ä¸­å¿ƒ</h2>";
    Object.keys(otherTeams).forEach(team=>{
      out.innerHTML+=`<button data-team="${team}">${team}</button>`;
    });
    out.querySelectorAll("button[data-team]").forEach(btn=>{
      btn.onclick=()=>{
        const team=btn.getAttribute("data-team");
        const theirs=otherTeams[team];
        let html=`<h3>èˆ‡ ${team} äº¤æ˜“</h3>`;
        html+= warriors.map((p,i)=><p/>).join("");
        html=`<div>
          <h4>é¸å‹‡å£«çƒå“¡ï¼ˆæœ€å¤š3ï¼‰</h4>` + warriors.map((p,i)=>`
            <label><input type=checkbox class=my data-idx=${i}> ${p.name}ï½œ${p.rating}</label><br>
          `).join("") + `
          <label><input type=checkbox id="myPick"> ç”¨æˆ‘æ–¹1å¼µé¦–è¼ªç±¤ (å‰©${picks["å‹‡å£«"]})</label>
          <h4>é¸å°æ–¹çƒå“¡ï¼ˆæœ€å¤š3ï¼‰</h4>` + theirs.map((p,i)=>`
            <label><input type=checkbox class=their data-idx=${i}> ${p.name}ï½œ${p.rating}</label><br>
          `).join("") + `
          <label><input type=checkbox id="theirPick"> è¦å°æ–¹1å¼µé¦–è¼ªç±¤</label><br>
          <button id="doTrade">æå‡ºäº¤æ˜“</button>
          <div id="tradeMsg"></div>
        </div>`;
        out.innerHTML=html;
        document.getElementById("doTrade").onclick=()=>{
          const mySel=[...out.querySelectorAll(".my:checked")].map(c=>warriors[+c.dataset.idx]);
          const theirSel=[...out.querySelectorAll(".their:checked")].map(c=>theirs[+c.dataset.idx]);
          if(mySel.length>3||theirSel.length>3){ alert("æœ€å¤š3æ›3"); return; }
          let valMy=mySel.reduce((a,p)=>a+ratingMap[p.rating],0)+ (out.myPick.checked?4:0);
          let valThe=theirSel.reduce((a,p)=>a+ratingMap[p.rating],0)+ (out.theirPick.checked?4:0);
          if(valMy-valThe>2){ out.tradeMsg.textContent="å°æ–¹è¦ºå¾—ä¸å¤ "; return; }
          if(valThe-valMy>4){ out.tradeMsg.textContent="ä½ åƒè™§å¤ªå¤š"; return; }
          // æˆåŠŸ
          if(out.myPick.checked){ if(picks["å‹‡å£«"]>0) picks["å‹‡å£«"]--; }
          if(out.theirPick.checked) picks["å‹‡å£«"]++;
          warriors = warriors.filter(p=>!mySel.includes(p)).concat(theirSel.map(p=>({...p,trainProgress:0,trained:false})));
          otherTeams[team] = theirs.filter(p=>!theirSel.includes(p)).concat(mySel);
          out.tradeMsg.textContent="âœ… äº¤æ˜“å®Œæˆï¼";
          save(); renderStatus(); showWarriors(); showTrade();
        };
      };
    });
  }

  function simulate(){
    const today=new Date().toDateString();
    if(lastDate===today){alert("ä»Šæ—¥å·²æ¨¡æ“¬ï¼Œæ˜å¤©å†ä¾†");return;}
    const teams=Object.keys(otherTeams);
    const opp=otherTeams[teams[Math.random()*teams.length|0]];
    const ts=warriors.reduce((a,p)=>a+ratingMap[p.rating]*(Math.random()+0.5),0);
    const os=opp.reduce((a,p)=>a+ratingMap[p.rating]*(Math.random()+0.5),0);
    const mvp = warriors.reduce((best,p)=>ratingMap[p.rating]*(Math.random()+0.5) > best.score? {name:p.name,score:ratingMap[p.rating]}:best,{name:"",score:0});
    document.getElementById("gameResult").innerHTML=`
      <h2>ğŸ€ æ¯”åˆ†ï¼š${ts|0}:${os|0}</h2><p>MVPï¼š${mvp.name}</p>`;
    lastDate=today; save(); renderStatus();
  }

  function reset(){
    warriors.forEach(p=>p.trained=false);
    alert("è¨“ç·´ç‹€æ…‹é‡ç½®");
    save(); showWarriors();
  }

  function dailyReset(){
    const today=new Date().toDateString();
    if(lastDate!==today){
      warriors.forEach(p=>p.trained=false);
      lastDate=today; save(); renderStatus(); showWarriors();
    }
  }

  document.addEventListener("DOMContentLoaded",()=>{
    load(); dailyReset(); renderStatus(); showWarriors();
    document.getElementById("showWarriorsBtn").onclick = showWarriors;
    document.getElementById("showFreeAgentsBtn").onclick = showFreeAgents;
    document.getElementById("showTradeBtn").onclick = showTrade;
    document.getElementById("simulateGameBtn").onclick = simulate;
    document.getElementById("resetTrainingBtn").onclick = reset;
    document.getElementById("clearBtn").onclick = ()=>{ if(confirm("æ¸…é™¤è³‡æ–™ï¼Ÿ")){localStorage.clear(); location.reload()} };
    setInterval(dailyReset,60000);
  });
})();
  </script>