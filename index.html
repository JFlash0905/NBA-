<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>Sniper J GM æ¨¡æ“¬å™¨ v0.9.0 Ultimate+</title>
  <style>
    body { font-family: sans-serif; background: #f0f0f0; padding: 20px; }
    h1 { color: #2c3e50; }
    button { margin:5px;padding:10px;font-size:16px;border-radius:5px;cursor:pointer;background:#3498db;color:#fff;border:none; }
    button:disabled { background:#aaa; cursor:not-allowed; }
    .player { background:#fff;margin:10px 0;padding:10px;border-radius:6px;display:flex;align-items:center;justify-content:space-between; }
    .player-info { flex-grow:1; }
    .container { max-width:900px; margin:auto; }
    .section { margin-top:30px; }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ€ Sniper J GM æ¨¡æ“¬å™¨ v0.9.0 Ultimate+</h1>
    <div>
      <button id="clearBtn">æ¸…ç©ºå­˜æª”</button>
      <span id="dateDisplay"></span>
      <div id="moneyDisplay"></div>
    </div>
    <div class="section">
      <button id="showWarriorsBtn">å‹‡å£«é™£å®¹</button>
      <button id="showFreeAgentsBtn">è‡ªç”±å¸‚å ´</button>
      <button id="showTradeBtn">äº¤æ˜“ä¸­å¿ƒ</button>
      <button id="simulateGameBtn">æ¨¡æ“¬æ¯”è³½</button>
      <button id="resetTrainingBtn">é‡ç½®è¨“ç·´</button>
    </div>
    <div id="teamDisplay"></div>
    <div id="freeAgentsDisplay"></div>
    <div id="tradeDisplay"></div>
    <div id="gameResult"></div>
  </div>

  <script>
    window.addEventListener("DOMContentLoaded", () => {
      const ratingMap = {"C":1,"C+":2,"B-":3,"B":4,"B+":5,"A-":6,"A":7,"A+":8,"S":9,"S+":10};
      const order = ["C","C+","B-","B","B+","A-","A","A+","S","S+"];

      let warriors, freeAgents, otherTeams, money, salaryCap, lastDate, picks, trainLimit;

      function defaultData() {
        return {
          warriors: [
            {name:"Stephen Curry",rating:"S",salary:35,trainProgress:0,trained:false},
            {name:"Klay Thompson",rating:"B+",salary:20,trainProgress:0,trained:false},
            {name:"Draymond Green",rating:"B",salary:18,trainProgress:0,trained:false}
          ],
          freeAgents: [
            {name:"Malik Beasley",rating:"B",salary:15,signChance:60},
            {name:"Robert Covington",rating:"B-",salary:12,signChance:50}
          ],
          otherTeams: {
            "é›·éœ†":[
              {name:"SGA",rating:"S",salary:34},
              {name:"Jalen Williams",rating:"A",salary:20}
            ],
            "é‡‘å¡Š":[
              {name:"Jokic",rating:"S+",salary:38},
              {name:"Jamal Murray",rating:"A",salary:27}
            ]
          },
          money:100, salaryCap:120, lastDate:null,
          picks:{"å‹‡å£«":2,"é›·éœ†":2,"é‡‘å¡Š":2}, trainLimit:5
        };
      }

      function load() {
        const s = localStorage.getItem("sj_v090");
        if (s) Object.assign(window, JSON.parse(s));
        else Object.assign(window, defaultData());
      }

      function save() {
        localStorage.setItem("sj_v090", JSON.stringify({warriors, freeAgents, otherTeams, money, salaryCap, lastDate, picks, trainLimit}));
      }

      function renderStatus() {
        const now = new Date().toLocaleDateString();
        const sal = warriors.reduce((a,p)=>a+p.salary,0);
        document.getElementById("dateDisplay").textContent = "ä»Šå¤©ï¼š" + now;
        document.getElementById("moneyDisplay").textContent = `è³‡é‡‘ï¼š$${money}Mã€€å·¥è³‡ï¼š${sal}/${salaryCap}Mã€€é¦–è¼ªç±¤ï¼š${picks["å‹‡å£«"]}`;
      }

      function showWarriors() {
        const out = document.getElementById("teamDisplay");
        out.innerHTML = "<h2>å‹‡å£«é™£å®¹</h2>";
        let trainedCount = warriors.filter(p=>p.trained).length;
        warriors.forEach((p,i) => {
          out.innerHTML += `
            <div class="player">
              <div class="player-info">
                <strong>${p.name}</strong>ï½œ${p.rating}ï½œâ˜…${"â˜…".repeat(Math.min(5,Math.round(ratingMap[p.rating]/2)))}ï½œ$${p.salary}M<br>
                è¨“ç·´é€²åº¦ï¼š${p.trainProgress}%
              </div>
              <button ${p.trained || trainedCount >= trainLimit ? "disabled" : ""} data-idx="${i}">è¨“ç·´</button>
            </div>`;
        });
        out.querySelectorAll("button").forEach(btn => {
          btn.onclick = () => {
            const i = +btn.getAttribute("data-idx");
            const p = warriors[i];
            p.trained = true;
            p.trainProgress += Math.floor(Math.random()*10+10);
            if (p.trainProgress >= 100) {
              const idx = order.indexOf(p.rating);
              if (idx < order.length - 1 && Math.random() < 0.3) {
                p.rating = order[idx+1];
                alert(`${p.name} å‡ç´šåˆ° ${p.rating}ï¼`);
              }
              p.trainProgress = 0;
            }
            save(); showWarriors(); renderStatus();
          };
        });
      }

      function showFreeAgents() {
        const out = document.getElementById("freeAgentsDisplay");
        out.innerHTML = "<h2>è‡ªç”±å¸‚å ´</h2>";
        freeAgents.forEach((p,i)=>{
          out.innerHTML += `
            <div class="player">
              <div class="player-info">${p.name}ï½œ${p.rating}ï½œ$${p.salary}M</div>
              <button data-idx="${i}">ç°½ç´„</button>
            </div>`;
        });
        out.querySelectorAll("button").forEach(btn=>{
          btn.onclick = () => {
            const i = +btn.getAttribute("data-idx");
            const p = freeAgents[i];
            if (money < p.salary) return alert("è³‡é‡‘ä¸è¶³ï¼");
            if (Math.random()*100 < p.signChance) {
              warriors.push({name:p.name, rating:p.rating, salary:p.salary, trainProgress:0, trained:false});
              money -= p.salary;
              freeAgents.splice(i,1);
              alert("ç°½ç´„æˆåŠŸï¼");
            } else alert("ç°½ç´„å¤±æ•—");
            save(); showWarriors(); showFreeAgents(); renderStatus();
          };
        });
      }

      function resetTraining() {
        warriors.forEach(p => p.trained = false);
        alert("å·²é‡ç½®ä»Šæ—¥è¨“ç·´ç‹€æ…‹ï¼");
        save(); showWarriors();
      }

      function simulateGame() {
        const today = new Date().toDateString();
        if (lastDate === today) return alert("ä»Šæ—¥å·²æ¨¡æ“¬ï¼");
        const teams = Object.values(otherTeams);
        const opp = teams[Math.floor(Math.random()*teams.length)];
        const myScore = warriors.reduce((a,p)=>a + ratingMap[p.rating]*(Math.random()+0.5),0);
        const oppScore = opp.reduce((a,p)=>a + ratingMap[p.rating]*(Math.random()+0.5),0);
        const mvp = warriors[Math.floor(Math.random()*warriors.length)].name;
        document.getElementById("gameResult").innerHTML = `<h2>æ¯”åˆ† ${Math.round(myScore)} : ${Math.round(oppScore)}</h2><p>MVPï¼š${mvp}</p>`;
        lastDate = today;
        save(); renderStatus();
      }

      document.getElementById("showWarriorsBtn").onclick = showWarriors;
      document.getElementById("showFreeAgentsBtn").onclick = showFreeAgents;
      document.getElementById("simulateGameBtn").onclick = simulateGame;
      document.getElementById("resetTrainingBtn").onclick = resetTraining;
      document.getElementById("clearBtn").onclick = () => {
        if (confirm("æ˜¯å¦æ¸…é™¤æ‰€æœ‰è³‡æ–™ï¼Ÿ")) {
          localStorage.clear(); location.reload();
        }
      };

      load(); renderStatus(); showWarriors();
    });
  </script>
</body>
</html>